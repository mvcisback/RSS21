\section{ERCI as multi-objective optimization}\label{sec:convex}
As may already be apparent to the reader, there is a natural trade off
between probability of generating paths in $\varphi$ (from here
onwards: \emph{the performance}) and causal entropy induced by a
policy (from here onwards: \emph{the randomization}).  In particular,
we are interested in understanding the combinations of $\scthreshold$
and $\randomness$ that allow to solve the (core) ERCI problem. To this
end, we cast ERCI as a variant of multi-objective optimization and
studying its Pareto front.

% It is convenient to consider this geometrically.
To begin, given a fixed ERCI instance, observe that a scheduler $\sched$
induces a point $x_\sched$:
\begin{equation}
  x_\sched \eqdef \Big\langle \Pr(X_\varphi \mid \sched), H(\sched) \Big\rangle \in [0,1] \times [0,\infty).  
\end{equation}
To ease notation, for $x_\sched = \langle \scp,\rndp \rangle$ we use
$\scp_\sched \eqdef \scp$ and $\rndp_\sched \eqdef \rndp$. Next, we
partially order these points via the standard product ordering:
\begin{equation}
  \langle \scp,\rndp \rangle \leq \langle \scp',\rndp' \rangle \implies \scp \leq \scp' \wedge \rndp \leq \rndp'.
\end{equation}

We say that $\pOneSched$ \emph{guarantees} a point $x_\pOne \eqdef
\langle \scp, \rndp \rangle$, if for every policy $\pTwoSched$, using
$\sched = \langle \pOneSched, \pTwoSched \rangle$, we have
$\scp_\sched \geq \scp$ and $\rndp_\sched \geq \rndp$. Thus, a point
is guaranteed if no matter what policy $\pTwo$ uses, $x_\sched$ will
induce a point no worse w.r.t.\ to either randomization or performance
than $x_\pOne$. Furthermore, observe that guaranteed points are
downward closed, i.e., if $\pOneSched$ guarantees $x$ and $x' \leq x$,
then $\pOneSched$ guarantees $x'$.

\begin{figure*}
\begin{subfigure}{0.19\textwidth}
\centering
\begin{tikzpicture}[scale=2.5]	
     	
  	\draw (0.85, 0.3) node[cross=2pt,color=blue] (c1) {};
  	\draw (0.78, 0.9) node[cross=2pt,color=blue] (c2) {};
  	\draw (0.6, 0.8) node[cross=2pt,color=blue] (c3) {};
  	
  	\node at (0.6,0.3) (x1) {};
  		\draw[fill=green!10!white,draw=green] (0,0) rectangle (x1);
  		 \draw[thick, ->] (-0.05, 0) -- (1, 0) node[below]{$\rndp$};
  	\draw[thick, ->] (0, -0.05) -- (0, 1) node[above] {$\scp$};

\fill[fill=blue!10] (c1.center)--(c2.center)--(c3.center);
	
	  \fill[fill=blue!20,pattern=north west lines,pattern color=blue] (c1.center)--(c2.center)--(c3.center);
	
  	
  	\draw[dashed] (0,0) |- (c1);
  	\draw[dotted] (0,0) |- (c2);
  	\draw[dotted] (0,0) |- (c3);
  	\draw[dotted] (0,0) -| (c1);
  	\draw[dotted] (0,0) -| (c2);
  	\draw[dashed] (0,0) -| (c3);
  	
  	 
  	\draw (x1) node[circle,fill=green, inner sep=1.5pt,draw=green!50!black] {};
  
  	
  	
\end{tikzpicture}
\caption{Guaranteed points $\solutions_\pOneSched$}
\end{subfigure}
\begin{subfigure}{0.19\textwidth}
\centering
\begin{tikzpicture}[scale=2.5]	
     	
  	\node at (0.6,0.3) (x1) {};
  		\node at (0.3,0.8) (x2) {};
  	
  		\node at (0.5,0.57778) (x3) {};
  	
  		\draw[fill=green!10!white,draw=green] (0,0) rectangle (x1);
  			\draw[fill=green!10!white,draw=green] (0,0) rectangle (x2);
  			
  			
  		 \draw[thick, ->] (-0.05, 0) -- (1, 0) node[below]{$\rndp$};
  	\draw[thick, ->] (0, -0.05) -- (0, 1) node[above] {$\scp$};
  	
  
    \fill[ domain=0.3:0.6, smooth, variable=\x, green!10!white,thick] plot ({\x}, {-5.555*(\x-0.3)*(\x-0.3) + 0.8}) -- (0.3,0.3);
    
  		\draw[name path=f, domain=0.3:0.6, smooth, variable=\x, green!50!black,thick] plot ({\x}, {-5.555*(\x-0.3)*(\x-0.3) + 0.8});
    
  	
  	\draw[dashed] (0,0) -| (x1);
  	\draw[dashed] (0,0) -| (x2);
  	 \draw[dashed] (0,0) |- (x1);
  	\draw[dashed] (0,0) |- (x2);
  	
  		\draw[-,thick,color=green!50!black] (0,0.8) -- (x2);
  	\draw[-,thick,color=green!50!black] (0.6,0.0) -- (x1);
  	 
  	\draw (x1) node[circle,fill=green, inner sep=1.5pt,draw=green!50!black] {};
  \draw (x2) node[circle,fill=green, inner sep=1.5pt,draw=green!50!black] {};
  \draw (x3) node[circle,fill=green, inner sep=1.5pt,draw=green!50!black] {};
  
  
  	
  	
\end{tikzpicture}
\caption{Solutions}
\end{subfigure}
\begin{subfigure}{0.19\textwidth}
\centering
\begin{tikzpicture}[scale=2.5]	
     	
  	\node at (0.6,0.3) (x1) {};
  		\node at (0.3,0.8) (x2) {};
  	
  		\node at (0.5,0.57778) (x3) {};
  		
  					\draw[draw=none,pattern= bricks, pattern color=black!50] (1,0) rectangle (x1);
  					
  					\draw[draw=none,pattern= bricks, pattern color=black!50] (0,1) rectangle (x2);
  	
  		\draw[fill=green!10!white,draw=green] (0,0) rectangle (x1);
  			\draw[fill=green!10!white,draw=green] (0,0) rectangle (x2);
  			
  				\draw[fill=red!10!white,draw=red!0!white] (1,1) rectangle (x1);
  			\draw[fill=red!10!white,draw=red!0!white] (1,1) rectangle (x2);
  					\draw[fill=red!10!white,draw=red!0!white] (1,1) rectangle (x3);
  						\draw[draw=red,dashed] (1,1) rectangle (x1);
  			\draw[draw=red,dashed] (1,1) rectangle (x2);
  					\draw[draw= red,dashed] (1,1) rectangle (x3);
  					
  					\draw[draw=none,dashed,pattern=dots, pattern color=red] (1,1) rectangle (x1);
  					\draw[draw=none,dashed,pattern=dots, pattern color=red] (1,1) rectangle (x2);
  					\draw[draw=none,dashed,pattern=dots, pattern color=red] (1,1) rectangle (x3);
  					
  					
  			
  		 \draw[thick, ->] (-0.05, 0) -- (1, 0) node[below]{$\rndp$};
  	\draw[thick, ->] (0, -0.05) -- (0, 1) node[above] {$\scp$};
  	
  	
  	 \fill[draw=green!50!black] (x2.center) -- (x3.center) -- (x1.center);
    \fill[color=green!10!white] (x2.center) -- (x3.center) -- (x1.center) --  (0.3,0.3);
    
%  		\draw[name path=f, domain=0.3:0.6, smooth, variable=\x, green!50!black,thick] plot ({\x}, {-5.555*(\x-0.3)*(\x-0.3) + 0.8});
%    
  	
  	\draw[dashed] (0,0) -| (x1);
  	\draw[dashed] (0,0) -| (x2);
  	 \draw[dashed] (0,0) |- (x1);
  	\draw[dashed] (0,0) |- (x2);
  	
  		\draw[-,thick,color=green!50!black] (0,0.8) -- (x2);
  	\draw[-,thick,color=green!50!black] (0.6,0.0) -- (x1);
  	 
  	\draw (x1) node[circle,fill=green, inner sep=1.5pt,draw=green!50!black] {};
  \draw (x2) node[circle,fill=green, inner sep=1.5pt,draw=green!50!black] {};
  \draw (x3) node[circle,fill=green, inner sep=1.5pt,draw=green!50!black] {};
  \node[anchor=north] at (0.6,0) {$\rndopt$};
  		
  		\node[anchor=north] at (0.3,0) {$\rndmin$};
  		
  		\node[anchor=east] at (0,0.85) {$\scopt$};
  		
  		\node[anchor=east] at (0,0.3) {$\scmin$};
  
  	
  	
\end{tikzpicture}
\caption{Solutions}
\end{subfigure}
\begin{subfigure}{0.19\textwidth}
\centering
\begin{tikzpicture}[scale=2.5]	
     	
  	\node at (0.85,0.1) (x1) {};
  		\node at (0.1,0.85) (x2) {};
  		
  		\node at (0.55,0.55) (x3) {};
  		
  		\node[anchor=north] at (0.85,0) {$\rndopt$};
  		\node[anchor=north] at (0.55,0) {$\randomness(\epsilon)$};
  		
  		\node[anchor=north] at (0.1,0) {$\rndmin$};
  		
  		\node[anchor=east] at (0,0.85) {$\scopt$};
  		\node[anchor=east] at (0,0.55) {$\scthreshold(\epsilon)$};
  		
  		\node[anchor=east] at (0,0.1) {$\scmin$};
  	
  		\draw[fill=green!10!white,draw=green] (0,0) rectangle (x1);
  			\draw[fill=green!10!white,draw=green] (0,0) rectangle (x2);
  			
  		 \draw[thick, ->] (-0.05, 0) -- (1, 0) node[below]{\phantom{$\rndp$}};
  	\draw[thick, ->] (0, -0.05) -- (0, 1) node[above] {\phantom{$\scp$}};
  	
  	\draw[dashed] (0,0) -| (x1);
  	\draw[dashed] (0,0) -| (x2);
  	 \draw[dashed] (0,0) |- (x1);
  	\draw[dashed] (0,0) |- (x2);
  	
  	 \draw[dashed] (0,0) |- (x3);
  	\draw[dashed] (0,0) -| (x3);
  	 
  	\draw (x1) node[circle,fill=green, inner sep=1.5pt,draw=green!50!black] {};
  	
  	\draw (x2) node[circle,fill=green, inner sep=1.5pt,draw=green!50!black] {};
  
  	
  	
  	\draw (x3) node[circle,draw,fill=white, inner sep=1.5pt,draw=black] {};
  	
\end{tikzpicture}
\caption{Solutions}
\end{subfigure}
\begin{subfigure}{0.19\textwidth}
\centering
\begin{tikzpicture}[scale=2.5]	
     	
  	\node at (0.85,0.1) (x1) {};
  		\node at (0.1,0.85) (x2) {};
  		
  		
  		\node[anchor=north] at (0.85,0) {$\rndopt$};
  		
  		\node[anchor=north] at (0.1,0) {$\rndmin$};
  		
  		\node[anchor=east] at (0,0.85) {$\scopt$};
  		
  		\node[anchor=east] at (0,0.1) {$\scmin$};
  	
  		\draw[fill=green!10!white,draw=green] (0,0) rectangle (x1);
  			\draw[fill=green!10!white,draw=green] (0,0) rectangle (x2);
  			
  		 \draw[thick, ->] (-0.05, 0) -- (1, 0) node[below]{\phantom{$\rndp$}};
  	\draw[thick, ->] (0, -0.05) -- (0, 1) node[above] {\phantom{$\scp$}};
  	
  	\draw[dashed] (0,0) -| (x1);
  	\draw[dashed] (0,0) -| (x2);
  	 \draw[dashed] (0,0) |- (x1);
  	\draw[dashed] (0,0) |- (x2);
  	
  	 
  	\draw (x1) node[circle,fill=green, inner sep=1.5pt,draw=green!50!black] {};
  	
  	\draw (x2) node[circle,fill=green, inner sep=1.5pt,draw=green!50!black] {};
  	
  	\draw (x1) node[cross=2pt,color=blue] (c3) {};
  	
  	\draw (x2) node[cross=2pt,color=blue] (c3) {};
  
  \draw[black,->] (0.4,0.1) arc (0:20:0.3cm);
  
  		\node at (0.79,0.34) (x3) {};
  			\draw (x3) node[circle,fill=green, inner sep=1.5pt,draw=green!50!black] {};
  			
  	\draw (x3) node[cross=2pt,color=blue] (c3) {};
  	\draw [-] (0.1,0.1) -- (x3);
   \draw[black,->] (0.45,0.1) arc (0:40:0.35cm);
   
   \node at (0.63,0.54) (x4) {};
  			\draw (x4) node[circle,fill=green, inner sep=1.5pt,draw=green!50!black] {};
  			
  	\draw (x4) node[cross=2pt,color=blue] (c3) {};
  	\draw [-] (0.1,0.1) -- (x4);
   
   \draw[black,->] (0.5,0.1) arc (0:58:0.4cm);
    \node at (0.46,0.67) (x5) {};
  			\draw (x5) node[circle,fill=green, inner sep=1.5pt,draw=green!50!black] {};
  			
  	\draw (x5) node[cross=2pt,color=blue] (c3) {};
  	\draw [-] (0.1,0.1) -- (x5);
   \draw[black,->] (0.55,0.1) arc (0:75:0.45cm);
   \node at (0.278,0.776) (x6) {};
  			\draw (x6) node[circle,fill=green, inner sep=1.5pt,draw=green!50!black] {};
  			
  	\draw (x6) node[cross=2pt,color=blue] (c3) {};
  	\draw [-] (0.1,0.1) -- (x6);
  	
   \draw[black,->] (0.23,0.58) arc (75:65:0.5cm);
   \node at (0.386,0.715) (x7) {};
  			\draw (x7) node[circle,fill=green, inner sep=1.5pt,draw=green!50!black] {};
  			
  	\draw (x7) node[cross=2pt,color=blue] (c3) {};
  	\draw [-] (0.1,0.1) -- (x7);

   
   \draw[-] (x1) -- (x3) -- (x4) -- (x5) -- (x7) -- (x6) -- (x2);
   
   \node[anchor=west,xshift=0.3em] at (x3) {\tiny{1:$\lambda{=}1$}};
   \node[anchor=west,xshift=0.3em] at (x4) {\tiny{2:$\lambda{=}2$}};
   \node[anchor=west,xshift=0.3em] at (x5) {\tiny{3:$\lambda{=}4$}};
   \node[anchor=west,yshift=0.3em,xshift=0.2em] at (x7) {\tiny{5:$\lambda{=}6$}};
   \node[anchor=west,yshift=0.4em,xshift=0.1em] at (x6) {\tiny{4:$\lambda{=}8$}};
  	
\end{tikzpicture}
\caption{Solutions}
\end{subfigure}

\caption{Geometric interpretation of the ERCI problem for some fixed SG.}
\end{figure*}

We then define the following elementary sets: For any $\pOneSched$,
that $\pOneSched$ guarantees $\langle \scp, \rndp \rangle$, we define
the set of guaranteed points:
\begin{equation}\label{eq:guaranteed}
  \solutions[\pOneSched] \eqdef \{ \langle \scp, \rndp \rangle \mid  \pOneSched \text{ guarantees } \langle \scp, \rndp \rangle \}.
\end{equation}

Any point that can be guaranteed by some $\pOneSched$ is called
\emph{achievable}, i.e., the achievable points are: $ \solutions =
\bigcup_{\pOneSched} \solutions[\pOneSched]$.  Importantly, it holds
that the ERCI problem is satisfiable iff $\langle \scthreshold,
\randomness \rangle$ is achievable.  \sj{We should clarify satisfiable
lingo} Thus, to solve ERCI instances, we start by characterizing
$\solutions$.


\begin{proposition}
  The set of achievable points, $\solutions$, is convex. 
\end{proposition}
\begin{proof}[Proof Sketch]
  Recall that a set is convex, if it is closed under
  convex-combinations\footnotemark. Consider two points
  $\langle \scp, \rndp \rangle, \langle \scp', \rndp' \rangle \in
  \solutions$ achieved by $\pOneSched$ and $\pOneSchedPrime$
  resp. Consider the new policy, $\pi$, defined by employing
  $\pOneSched$ with probability $q$ and $\pOneSchedPrime$ with
  probability $\bar{q} \eqdef 1 - q$.  Because each policy
  \emph{guarantees} its corresponding performance, this new policy as
  performance at least $q\cdot \scp + \bar{q}\cdot \scp'$.  Similarly,
  by viewing $\pi$ as a random variable and applying chain rule
  yields,
  \begin{equation}
    \begin{split}
      H_\tau(\sigma)
      \geq &~q \cdot H( \rv{A}^{\pOne}_{1:\tau'} \mid\mid \rv{S}_{1:\tau} \mid \pi=\pOneSched)~+\\
      &~\bar{q}  \cdot H( \rv{A}^{\pOne}_{1:\tau'} \mid\mid \rv{S}_{1:\tau} \mid \pi=\pOneSchedPrime)\\
      =&~q\cdot\rndp + \bar{q}\cdot \rndp'.
    \end{split}
  \end{equation}
  Thus, any convex combination of guaranteed points is guaranteed by
  a convex combination of the resp. ego policies.
\end{proof}
\footnotetext{
  That is, $y, y' \in Y$ implies for
  every $w \in [0,1]$ that $w \cdot y + (1-w) \cdot y \in Y$
}

Next, observe that because $\solutions$ is downward closed, it
suffices to study the ``maximal'' or non-dominated points.  Precisely,
we say that a point $x$ is \emph{dominated} by $x'$, written $x \prec
x'$, if $x'$ is strictly larger in at least one dimension and not
smaller in the other, i.e., 
\begin{equation}
x \prec x' \iff x \leq x' \wedge x \neq x'.
\end{equation}
The Pareto-front $\pareto{\solutions}$ of $\solutions$ is then the set of non-dominated guaranteed points,
\begin{equation}
  \pareto{\solutions} \eqdef \{ x \in \solutions \mid \forall x' \in \solutions, x \not\prec x'  \}.  
\end{equation}
\noindent
\begin{mdframed}
Importantly, it holds that the ERCI problem is satisfiable iff there exists a  $x \in \pareto{\solutions}$ such that $\langle \scthreshold, \randomness \rangle \prec x$.    
\end{mdframed}

\noindent
Thus the approximating the Pareto-front gives a natural approximation
scheme for ERCI instances. Namely, for any subset $\pareto{} \subseteq
\pareto{\solutions}$,
\begin{enumerate}
\item If there exists an $x \in \pareto{}$ such that
$\langle \scthreshold, \randomness \rangle \prec x$, then the ERCI
Problem must be satisfiable.
\item If there exists an $x \in \pareto{}$
such that $x \prec \langle \scthreshold, \randomness \rangle$ then the
ERCI problem is not satisfiable.
\end{enumerate}

\begin{example}
	
\end{example}

Thus a key algorithmic question in ERCI is how to efficiently explore
and approximate the $\pareto{\solutions}$.  
To this end, we note that while $\solutions$ is defined as a subset of $[0,1] \times [0,\infty)$, we can restrict ourselves to the domain in which we can actually trade performance for randomness. 
We define 
$\rndopt \eqdef \max \{ \rndp \mid \exists \scp \text{ s.t. } \langle \scp, \rndp \rangle \in \solutions  \} $, i.e., the largest randomness that can be guaranteed by any $\pOne$-policy. 
Likewise, we define 
$\scopt \eqdef \max \{ \scp \mid \exists \rndp \text{ s.t. } \langle \scp, \rndp \rangle \in \solutions  \} $, i.e., the largest performance that can be guaranteed by any $\pOne$-policy. 
Then, we define 
$\scmin \eqdef \max \{ \scp \mid \langle \scp, \rndopt \rangle  \in \solutions \}$, the best performance that $\pOne$ can guarantee while guaranteeing optimal randomness. 
Likewise, we define  the analogous $\rndmin \eqdef \max \{ \scp \mid \langle \scp, \rndopt \rangle  \in \solutions \}$.
We thus obtain two points on the Pareto-curve: $\langle \scmin, \rndopt \rangle$ and $\langle \scopt, \rndmin \rangle$, and intuitively, we can trade between these two points following the Pareto curve.

\begin{remark}[Regret Based ERCI]
  In practice, rather that fixing $\scthreshold$ and $\randomness$ a
  priori, one seeks achieve some percentage of the achievable soft
  constraint or causal entropy measure.  In such cases, we
  re-parameterized the ERCI instance with:
  \begin{equation}
    \scthreshold(\epsilon) \eqdef \epsilon \cdot \scopt
    \hspace{3em}
    \randomness(\delta) \eqdef  \delta \cdot \rndopt
  \end{equation}
  where $\epsilon, \delta \in [0, 1]$. As we shall later see, these maximum quantities are
  directly computed in our proposed algorithm.
\end{remark}

Finally, it is helpful to think about the Pareto-curve as a function
in $\rndp$.  We define a characteristic function which given a target
performance ratio, $\epsilon$, yields the optimal randomness ratio,
$\delta$:
\begin{equation}
  \begin{split}
    & \solfuncp\colon [0,1] \rightarrow [0, 1]    \\
    & \solfuncp(\delta) = \max_\epsilon \{ \rndp(\delta) \mid \langle
    \scp(\epsilon), \rndp(\delta) \rangle \in \solutions \} 
  \end{split}
\end{equation}
\begin{proposition}\label{prop:monotone}
  $\solfuncp$ is smooth and (strictly) monotonically decreasing.
\end{proposition}
In particular, the set is \emph{not} a finite polytope, but can be
well approximated by one. We shall however post-pone the proof of
\propref{monotone} until Sec ?. For now, one case observe that
(non-strict) monotone decreasing follows directly from convexity and
using the adequate domains.


With these facts, we are now well-equiped to develop the algorithms in Sec.~\ref{sec:mdps} for MDPs and Sec.~\ref{sec:sgs} for SGs.

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
